---
layout: post
title: 'Arduino Accelerometer Success On Second Try: Mozzi + MMA7660'
date: 2019-07-30 11:29:19.000000000 +00:00
type: post
post_id: '19077'
parent_id: '0'
published: true
password: ''
status: publish
categories:
- Arduino
tags:
- Accelerometer
- Mozzi
meta:
  _thumbnail_id: '19080'
  _rest_api_published: '1'
  _rest_api_client_id: "-1"
  _oembed_48c75ba46e193a6676f373de26d89594: '<div class="embed-twitter"><blockquote
    class="twitter-tweet" data-width="500" data-dnt="true"><p lang="en" dir="ltr">Update:
    Round 2 was successful! All I had to do was suppress my perfectionist tendencies.
    Thanks(?) to <a href="https://twitter.com/MLE_Online?ref_src=twsrc%5Etfw">@MLE_Online</a>  encouragement:
    &quot;Roger, don&#39;t worry, you&#39;ve seen the quality of Arduino code other
    people put out there.&quot; <a href="https://t.co/yeRWG5G6eQ">https://t.co/yeRWG5G6eQ</a>
    <a href="https://t.co/uqjil8IDdF">pic.twitter.com/uqjil8IDdF</a></p>&mdash; Roger
    Cheng (@Regorlas) <a href="https://twitter.com/Regorlas/status/1156100288941449217?ref_src=twsrc%5Etfw">July
    30, 2019</a></blockquote><script async src="https://platform.twitter.com/widgets.js"
    charset="utf-8"></script></div>'
  _oembed_time_48c75ba46e193a6676f373de26d89594: '1564482787'
  _oembed_85ba60d91a8728dfd8428bc0d5639f45: '<div class="embed-twitter"><blockquote
    class="twitter-tweet" data-width="550" data-dnt="true"><p lang="en" dir="ltr">Update:
    Round 2 was successful! All I had to do was suppress my perfectionist tendencies.
    Thanks(?) to <a href="https://twitter.com/MLE_Online?ref_src=twsrc%5Etfw">@MLE_Online</a>  encouragement:
    &quot;Roger, don&#39;t worry, you&#39;ve seen the quality of Arduino code other
    people put out there.&quot; <a href="https://t.co/yeRWG5G6eQ">https://t.co/yeRWG5G6eQ</a>
    <a href="https://t.co/uqjil8IDdF">pic.twitter.com/uqjil8IDdF</a></p>&mdash; Roger
    Cheng (@Regorlas) <a href="https://twitter.com/Regorlas/status/1156100288941449217?ref_src=twsrc%5Etfw">July
    30, 2019</a></blockquote><script async src="https://platform.twitter.com/widgets.js"
    charset="utf-8"></script></div>'
  _oembed_time_85ba60d91a8728dfd8428bc0d5639f45: '1564511361'
  _oembed_f50643252cb21c40b9712db77a6ad48f: '<div class="embed-twitter"><blockquote
    class="twitter-tweet" data-width="550" data-dnt="true"><p lang="en" dir="ltr">Update:
    Round 2 was successful! All I had to do was suppress my perfectionist tendencies.
    Thanks(?) to <a href="https://twitter.com/MLE_Online?ref_src=twsrc%5Etfw">@MLE_Online</a>  encouragement:
    &quot;Roger, don&#39;t worry, you&#39;ve seen the quality of Arduino code other
    people put out there.&quot; <a href="https://t.co/yeRWG5G6eQ">https://t.co/yeRWG5G6eQ</a>
    <a href="https://t.co/uqjil8IDdF">pic.twitter.com/uqjil8IDdF</a></p>&mdash; Roger
    Cheng (@Regorlas) <a href="https://twitter.com/Regorlas/status/1156100288941449217?ref_src=twsrc%5Etfw">July
    30, 2019</a></blockquote><script async src="https://platform.twitter.com/widgets.js"
    charset="utf-8"></script></div>'
  timeline_notification: '1564511362'
  _publicize_job_id: '33449978430'
  _oembed_time_f50643252cb21c40b9712db77a6ad48f: '1564511364'
  _oembed_ed356c8f40ca273793fce9b5cd5d50d6: '<div class="embed-twitter"><blockquote
    class="twitter-tweet" data-width="550" data-dnt="true"><p lang="en" dir="ltr">Update:
    Round 2 was successful! All I had to do was suppress my perfectionist tendencies.
    Thanks(?) to <a href="https://twitter.com/MLE_Online?ref_src=twsrc%5Etfw">@MLE_Online</a>  encouragement:
    &quot;Roger, don&#39;t worry, you&#39;ve seen the quality of Arduino code other
    people put out there.&quot; <a href="https://t.co/yeRWG5G6eQ">https://t.co/yeRWG5G6eQ</a>
    <a href="https://t.co/uqjil8IDdF">pic.twitter.com/uqjil8IDdF</a></p>&mdash; Roger
    Cheng (@Regorlas) <a href="https://twitter.com/Regorlas/status/1156100288941449217?ref_src=twsrc%5Etfw">July
    30, 2019</a></blockquote><script async src="https://platform.twitter.com/widgets.js"
    charset="utf-8"></script></div>'
  _oembed_time_ed356c8f40ca273793fce9b5cd5d50d6: '1564511364'
  _oembed_499e4c04e8bfc45f285d55124c17cee4: '<div class="embed-twitter"><blockquote
    class="twitter-tweet" data-width="550" data-dnt="true"><p lang="en" dir="ltr">Update:
    Round 2 was successful! All I had to do was suppress my perfectionist tendencies.
    Thanks(?) to <a href="https://twitter.com/MLE_Online?ref_src=twsrc%5Etfw">@MLE_Online</a>  encouragement:
    &quot;Roger, don&#39;t worry, you&#39;ve seen the quality of Arduino code other
    people put out there.&quot; <a href="https://t.co/yeRWG5G6eQ">https://t.co/yeRWG5G6eQ</a>
    <a href="https://t.co/uqjil8IDdF">pic.twitter.com/uqjil8IDdF</a></p>&mdash; Roger
    Cheng (@Regorlas) <a href="https://twitter.com/Regorlas/status/1156100288941449217?ref_src=twsrc%5Etfw">July
    30, 2019</a></blockquote><script async src="https://platform.twitter.com/widgets.js"
    charset="utf-8"></script></div>'
  _oembed_time_499e4c04e8bfc45f285d55124c17cee4: '1708471096'
  _elasticsearch_data_sharing_indexed_on: '2024-11-18 13:25:14'
author:
  login: inkarc
  email: luxo.lamp@gmail.com
  display_name: Roger Cheng
  first_name: Roger
  last_name: Cheng
permalink: "/2019/07/30/second-attempt-success-mozzi-mma7660/"
---
<p><!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/REC-html40/loose.dtd"><br />
<html><body><br />
<a href="https://newscrewdriver.com/2019/07/23/aborted-attempt-at-arduino-accelerometer-mozzi-mma7660/">When we left off earlier</a>, Emily and I determined that getting her MMA7660 I2C accelerometer breakout board to work with Mozzi on an Arduino will require more work than it looked at first glance, and probably not worth the trouble. Emily has since <a href="https://twitter.com/MLE_Online/status/1155146247205871616">moved on to a different accelerometer module</a>, one which communicates via analog voltage values. But I had a harder time letting go. Some <a href="https://twitter.com/MLE_Online/status/1153745323895877632">helpful comments</a> on Twitter plus <a href="https://newscrewdriver.com/2019/07/23/aborted-attempt-at-arduino-accelerometer-mozzi-mma7660/#comment-2383">Randy Glenn's comment</a> on the previous blog post motivated me to take another run with different objectives.</p>
<p>The first change was a reduction in problem scope: I originally thought I'd update the <a href="https://github.com/Seeed-Studio/Accelerometer_MMA7660">MMA7660 library</a> using fragments from Mozzi's non-blocking I2C example. This time I'm going the other way: I'm modifying Mozzi's non-blocking I2C example by pulling fragments from the MMA7660 library. This is a tiny subset of capability and coding. Notably absent are any sort of error-handling... not even that wacky use of <code>goto</code> that make seasoned programmer eyes twitch.</p>
<p>The second change was a change in attitude: I see a lot of violations of good coding conventions, and I wanted to fix them all. Especially problems horrible for code robustness such as poor error-handling. But talking with others who have played with Arduino longer than I have, I learned code quality has not exactly been a barrier for people putting Arduino code online. As I'm starting with a piece of Mozzi example code, all I had to do is make sure I don't make that code worse, and I should be good to go.</p>
<p>Easing those two constraints (a.k.a. lowering expectations) made for a much easier task, one which was ultimately successful! The Mozzi example chirped at one of three different pitches depending on if the ADXL345 reported X, Y, Z value over half of its range. (And stays silent if none of them were.) Now it chirps in response to MMA7660 data instead. Here's the short demonstration video I tweeted. (Be sure to turn on sound.)</p>
<p>https://twitter.com/Regorlas/status/1156100288941449217</p>
<p>There was one technical challenge in capturing that video clip: I didn't have an audio amplifier on hand, so the tiny speaker was powered directly by the Arduino Nano and thus extremely quiet. To capture the chirps, I plugged in a <a href="https://www.monoprice.com/product?p_id=18591">wired earbud headphone with mic</a> to my cell phone for filming. Its microphone module was placed next to the quietly chirping speaker and visible in the picture/video. I prefer not to have such items in the field of view, but it's what I had to do.</p>
<p>It turns out the MMA7660 is not appropriate for what Emily had in mind anyway. This module was designed for detecting portrait/landscape orientation and had very poor resolution: 5 bits, or values from zero to 63 to cover a range +/- 1.5G. Moving through an 180 degree arc under normal gravity, we see about 40 out of those 64 values. This translates to one tick every ~4.5 degrees. A <a href="https://twitter.com/MLE_Online/status/1155535595919167488">gently swinging pendulum</a> like what Emily had in mind would only ever see four or five different values through its entire range of motion and not nearly enough to make interesting sounds.</p>
<p>But that's OK, I'm sure it'll be useful for something else in the future. I've made my modified Mozzi example <a href="https://github.com/Roger-random/Mozzi_MMA7660">available on Github</a> in case Emily or I or anyone else decide to put the MMA7660 accelerometer in a Mozzi sketch. And if someone is less interested in that specific module but more curious about how to adapt from one I2C peripheral to another, they can look at <a href="https://github.com/Roger-random/Mozzi_MMA7660/commit/67f0d38209dffe1e35d3374c59134d74bae5151b">this commit</a> to see every line I changed.</body></html></p>
