---
layout: post
title: TMP36 Temperature Sensor + ESP8266 = Not a Great Team
date: 2022-07-27 12:30:00.000000000 +00:00
type: post
post_id: '31647'
parent_id: '0'
published: true
password: ''
status: publish
categories:
- Investigations
- Projects
tags:
- ESP8266
- ESPHome
- Home Assistant
meta:
  _last_editor_used_jetpack: block-editor
  _thumbnail_id: '31649'
  _publicize_job_id: '75177627521'
  timeline_notification: '1658950206'
  _elasticsearch_data_sharing_indexed_on: '2024-11-18 13:32:29'
author:
  login: inkarc
  email: luxo.lamp@gmail.com
  display_name: Roger Cheng
  first_name: Roger
  last_name: Cheng
permalink: "/2022/07/27/tmp36-temperature-sensor-esp8266-not-a-great-team/"
---
<p><!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/REC-html40/loose.dtd"><br />
<!-- wp:paragraph --><html><body></p>
<p>After successfully <a href="https://newscrewdriver.com/2022/07/26/high-side-fan-esp8266-pwm-using-optocoupler/">building a small circuit for 3-pin fan PWM control</a>, I decided to add a temperature sensor. Now I have the option to make it smarter about adjusting speed (or stopping entirely) based on temperature. There are many temperatures sensor options, I decided to start simply and inexpensively with a sensor that returns an analog voltage representing temperature. <a rel="noreferrer noopener" href="https://amzn.to/3azKdWW" target="_blank">A batch of TMP36</a> (*) seemed like a good starting point.</p>
<p><!-- /wp:paragraph --></p>
<p><!-- wp:paragraph --></p>
<p>According to the <a rel="noreferrer noopener" href="https://www.analog.com/en/products/tmp36.html" target="_blank">Analog Devices datasheet</a>, TMP36 output pin voltage is 0.75V at 25 degrees Celsius. For every degree of temperature rise, voltage increases 0.01V. For my first draft I wired it to my Wemos D1 Mini module's analog input pin. But I had to adjust the scaling because a D1 Mini includes a voltage divider to scale input of 0-3.3V down to ESP8266 ADC range of 0-1V. This voltage divider (and math necessary to convert it back) added error to the reading. Since I intend to use this sensor for measuring room temperature, I do not expect to measure above 50 degrees Celsius (122 Farenheit) which corresponded to 1 Volt. Thus, I soldered a wire to connect TMP36 signal directly to ESP8266 module analog input, bypassing the voltage divider.</p>
<p><!-- /wp:paragraph --></p>
<p><!-- wp:paragraph --></p>
<p>I noticed that there appears to be a startup time period where the temperature reading is 2-3 degrees too high but, after about 5-10 minutes, it will drop to a steady state temperature and stay there. I'm not sure if this startup behavior is from the TMP36 sensor or from the ESP8266 ADC. Either way, it meant I could not use this sensor in a sleep/read/sleep/read cycle because such a quick read will always result in a too-high value from this startup behavior.</p>
<p><!-- /wp:paragraph --></p>
<p><!-- wp:paragraph --></p>
<p>With the initial breadboard test complete, I built a dedicated temperature sensor node with just an ESP8266 with a TMP36. In the interest of compactness, I decided to solder the sensor directly to ESP8266 module pins.</p>
<p><!-- /wp:paragraph --></p>
<p><!-- wp:image {"align":"center","id":31649,"sizeSlug":"large","linkDestination":"none"} --></p>
<figure class="wp-block-image aligncenter size-large"><img src="https://newscrewdriver.com/wp-content/uploads/2022/07/tmp36-sensor-soldered-directly-to-esp8266-module.jpg?w=1024" alt="" class="wp-image-31649"></figure>
<p><!-- /wp:image --></p>
<p><!-- wp:paragraph --></p>
<p>Upon startup, I saw that it reported temperature that was a few degrees too high, but I thought that was just the startup behavior I already noticed. But instead of dropping, it had kept going up. I thought I had a bad TMP36 until I realized it was accurately reading heat generated by a running ESP8266. According to my USB power meter, it consumed less than a third of a Watt, but that's plenty of heat for a directly-mounted TMP36 to pick up.</p>
<p><!-- /wp:paragraph --></p>
<p><!-- wp:image {"align":"center","id":31648,"sizeSlug":"large","linkDestination":"none"} --></p>
<figure class="wp-block-image aligncenter size-large"><img src="https://newscrewdriver.com/wp-content/uploads/2022/07/tmp36-sensor-on-a-wire-to-physically-separate-from-esp8266-module.jpg?w=1024" alt="" class="wp-image-31648"></figure>
<p><!-- /wp:image --></p>
<p><!-- wp:paragraph --></p>
<p>If I wanted to measure a room's air temperature and not temperature of a running ESP8266, I needed to give the sensor some distance. But even then, the readings weren't reliable.</p>
<p><!-- /wp:paragraph --></p>
<p><!-- wp:paragraph --></p>
<p>A little web research taught me that the ESP8266 ADC isn't very precise nor is it calibrated. For most applications, being off by a few hundredth of a volt is a negligible error, but here every hundredth of a volt represents an entire degree of temperature which is decidedly <em>not </em>negligible. <a href="https://esphome.io/components/sensor/index.html#sliding-window-moving-average">Taking multiple values and averaging them</a> did help with the precision, but not accuracy. Knowing what I know now, in hindsight I should have done this with an ESP32. Those chips (or at least newer units) have their ADCs <a rel="noreferrer noopener" href="https://docs.espressif.com/projects/esp-idf/en/latest/esp32/api-reference/peripherals/adc.html#adc-calibration" target="_blank">calibrated at Espressif factory</a>. Though it is more likely that I will try a different temperature sensor in a future project. Either way, right now I have TMP36 on hand with a circuit board suitable for controlling 3-wire PC cooling fans. Time to put them together to <a href="https://newscrewdriver.com/2022/07/28/temperature-responsive-cereal-box-fan/">do something useful</a>.</p>
<p><!-- /wp:paragraph --></p>
<p><!-- wp:separator --></p>
<hr class="wp-block-separator has-alpha-channel-opacity">
<!-- /wp:separator --></p>
<p><!-- wp:paragraph --></p>
<p>Even though it doesn't work very well, here's an ESPHome YAML excerpt anyway. This will read a TMP36 every second and report average value every five minutes. TMP36 signal is assumed to have been soldered directly to ESP8266 analog input, bypassing Wemos D1 Mini voltage divider.</p>
<p><!-- /wp:paragraph --></p>
<p><!-- wp:code --></p>
<pre class="wp-block-code"><code>sensor:
  - platform: adc
    pin: A0
    name: "Mobile Node Temperature"
    unit_of_measurement: "Â°C"
    update_interval: 1s
    accuracy_decimals: 2
    filters:
      - multiply: 100
      - offset: -50
      - sliding_window_moving_average:
          window_size: 450
          send_every: 300
          send_first_at: 15</code></pre>
<p><!-- /wp:code --></p>
<p><!-- wp:paragraph {"align":"center"} --></p>
<p class="has-text-align-center">(*) Disclosure: As an Amazon Associate I earn from qualifying purchases.</p>
<p><!-- /wp:paragraph --><br />
</body></html></p>
